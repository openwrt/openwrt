<%+header%>
<style>
    /* è¡¨å¤´å’Œå†…å®¹å±…ä¸­å¯¹é½ï¼Œé’ˆå¯¹ç¬¬äºŒåˆ— */
    table th:nth-child(2),
    table td:nth-child(2) {
        text-align: left;
        width: 100%; /* ç¬¬äºŒåˆ—å®½åº¦å æ»¡å‰©ä½™ç©ºé—´ */
        height: 100%;
        color: rgb(0, 0, 0);
        font-size: 11px; /* è°ƒæ•´å­—ä½“å¤§å° */
        background-color: rgb(255, 255, 255); /* è®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºæ©™è‰² */
    }
        /* è¡¨å¤´å’Œå†…å®¹å±…ä¸­å¯¹é½ï¼Œé’ˆå¯¹ç¬¬äºŒåˆ— */
    table th:nth-child(3),
    table td:nth-child(3) {
        text-align: left;
        width: 100%; /* ç¬¬äºŒåˆ—å®½åº¦å æ»¡å‰©ä½™ç©ºé—´ */
        height: 100%;
        color: rgb(0, 0, 0);
        font-size: 10px; /* è°ƒæ•´å­—ä½“å¤§å° */
        white-space: nowrap; /* é˜²æ­¢æ¢è¡Œ */
        background-color: rgb(255, 255, 255); /* è®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºæ©™è‰² */
    }
    table th:nth-child(1),
    table td:nth-child(1) {
        text-align: center;
        width: 10%;
        color: rgb(0, 0, 0);
        font-size: 10px; /* è°ƒæ•´å­—ä½“å¤§å° */
        font-family: 'Microsoft YaHei', sans-serif; /* è®¾ç½®å­—ä½“ä¸ºå¾®è½¯é›…é»‘ */
        white-space: nowrap; /* é˜²æ­¢æ¢è¡Œ */
        background-color: rgb(164, 215, 255); /* è®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºæ©™è‰² */
        border-radius: 0; /* é»˜è®¤ä¸è®¾ç½®åœ†è§’ */
    }
    
    table tr:first-child th:nth-child(1),
    table tr:first-child td:nth-child(1) {
        border-radius: 8px 0 0 0; /* åªåœ¨å·¦ä¸Šè§’è®¾ç½®åœ†è§’ */
    }

    /* è®¾ç½®æœ€åä¸€è¡Œç¬¬ä¸€åˆ—å•å…ƒæ ¼çš„å·¦ä¸‹è§’å‘ä¸Šåœ†è§’ */
    table tr:last-child th:nth-child(1),
    table tr:last-child td:nth-child(1) {
        border-radius: 0 0 0 8px; /* åªåœ¨å·¦ä¸‹è§’è®¾ç½®åœ†è§’ */
    }
    /* è®¾ç½®ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—å•å…ƒæ ¼çš„å·¦ä¸Šè§’å‘ä¸‹åœ†è§’ */
    table tr:first-child th:nth-child(3),
    table tr:first-child td:nth-child(3) {
        border-radius: 0 8px 0 0; /* åªåœ¨å·¦ä¸Šè§’è®¾ç½®åœ†è§’ */
    }

    /* è®¾ç½®æœ€åä¸€è¡Œç¬¬ä¸€åˆ—å•å…ƒæ ¼çš„å·¦ä¸‹è§’å‘ä¸Šåœ†è§’ */
    table tr:last-child th:nth-child(3),
    table tr:last-child td:nth-child(3) {
        border-radius: 0 0 8px 0; /* åªåœ¨å·¦ä¸‹è§’è®¾ç½®åœ†è§’ */
    }
    /* ä¿¡å·æŒ‡ç¤ºå™¨æ ·å¼ */
    .signal-indicator {
        display: inline-block;
        margin-left: 10px;
        vertical-align: middle;
        position: relative;
        width: 65px;
        height: 20px;
    }
    .signal-bar {
        display: inline-block;
        width: 8px;
        background-color: grey;
        border-radius: 2px;
        position: absolute;
        bottom: 0;
    }
    .signal-bar-1 { height: 25%; left: 0; }
    .signal-bar-2 { height: 40%; left: 12px; }
    .signal-bar-3 { height: 60%; left: 24px; }
    .signal-bar-4 { height: 80%; left: 36px; }
    .signal-bar-5 { height: 100%; left: 48px; }
    /* ä¿¡å·çš„é¢œè‰²ï¼ŒåŠ¨æ€è®¾å®š */
    .signal-strong { background-color: #00ff00; }
    .signal-medium { background-color: #ffff00; }
    .signal-weak { background-color: #ff0000; }
    /* èƒ½é‡æ¡å’Œä¿¡å·æŒ‡ç¤ºå™¨çš„å®¹å™¨ */
    .energy-bar-container {
        display: flex;
        align-items: center;
    }
    .energy-bar {
        width: 100%;
        height: 20px;
        background-color: rgb(238, 238, 238);
        border-radius: 10px;
        overflow: hidden;
    }
    .energy-bar-fill {
        height: 100%;
        transition: width 0.5s ease-in-out;
    }
    .energy-bar-text {
        font-size: 10px;
        font-weight: bold;
        margin-left: 5px;
    }
    .energy-bar-fill {
        position: relative;
    }
    .energy-bar-text {
        position: absolute;
        top: 0;
        right: 5px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-end;
    }
    g {color: #808080; font-size: 75%; vertical-align: super;}
    .energy-bar {
        width: 100%;
        height: 20px;
        background-color: rgb(238, 238, 238);
        border-radius: 10px;
        overflow: hidden;
    }
    .energy-bar-fill {
        height: 100%;
        transition: width 0.5s ease-in-out;
    }
    .energy-bar-text {
        font-size: 10px;
        font-weight: bold;
        margin-left: 5px;
    }
    .energy-bar-fill {
        position: relative;
    }
    .energy-bar-text {
        position: absolute;
        top: 0;
        right: 5px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-end;
    }
    .temperature-bar {
        width: 100%;
        height: 20px;
        background-color: #eee;
        border-radius: 10px;
        overflow: hidden;
    }
    .temperature-bar-fill {
        height: 100%;
        transition: width 0.5s ease-in-out;
    }
    .temperature-bar-text {
        font-size: 10px;
        font-weight: bold;
        margin-left: 5px;
    }
    .temperature-bar-fill {
        position: relative;
    }
    .temperature-bar-text {
        position: absolute;
        top: 0;
        right: 5px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-end;
    }
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        color: #333;
        z-index: 1000;
        display: none;
    }
    /* å•å…ƒæ ¼å†…éƒ¨æ ·å¼ */
    table td, table th {
        padding: 10px;
        background-color: transparent;
        position: relative; /* ä¸ºåˆ†å‰²çº¿çš„ç»å¯¹å®šä½åšå‡†å¤‡ */
    }
    table td {
        position: relative; /* ç¡®ä¿ç»å¯¹å®šä½çš„åˆ†å‰²çº¿ç›¸å¯¹äºå•å…ƒæ ¼å®šä½ */
    }
    /* æ¨¡å—å‚å®¶è‰ºæœ¯å­—æ ·å¼ */
    #modem {
        color: rgb(182, 116, 1);
        font-weight: bold;
        text-shadow: 1px 0px 0px black;
    }
    /* ä¿¡å·å’Œæ¥æ”¶æŒ‡ç¤ºæ¡æ ·å¼ */
    .signal-bar {
        display: inline-block;
        width: 8px;
        border-radius: 2px;
        position: absolute;
        bottom: 0;
    }
    /* æŒ‡ç¤ºæ¡æ ·å¼ */
    .indicator-bar {
        height: 20px;
        background-color: rgb(238, 238, 238);
        border-radius: 10px;
        width: 100%;
        overflow: hidden;
    }
    .indicator-fill {
        height: 100%;
        transition: width 0.5s ease-in-out;
        position: relative; /* ä½¿æ–‡æœ¬ç»å¯¹å®šä½ç›¸å¯¹äºå¡«å……éƒ¨åˆ† */
    }
    .indicator-text {
        position: absolute; /* ç»å¯¹å®šä½ */
        right: 5px; /* å³ä¾§è¾¹è· */
        top: 0; /* é¡¶éƒ¨å¯¹é½ */
        height: 100%;
        display: flex;
        align-items: center; /* å‚ç›´å±…ä¸­ */
        justify-content: flex-end; /* å³ä¾§å¯¹é½ */
        color: rgb(0, 0, 0); /* æ–‡å­—é¢œè‰² */
    }
    .hidden {
        display: none; /* éšè—å†…å®¹çš„æ ·å¼ */
    }
    .loading {
        font-style: italic;
        color: #999;
    }
</style>
<script type="text/javascript">//<![CDATA[
    function createRSSIIndicator(value) {
        var indicator = document.createElement('div');
        indicator.className = 'indicator-bar';

        var fill = document.createElement('div');
        fill.className = 'indicator-fill';
        fill.style.width = ((value + 120) / 107) * 100 + '%'; // è®¡ç®—æ¯”ä¾‹

        var description = '';
        if (value > -55) {
            fill.style.backgroundColor = '#00ff00'; // ç»¿è‰²
            description = 'ä¼˜ç§€';
        } else if (value > -75) {
            fill.style.backgroundColor = '#ffff00'; // é»„è‰²
            description = 'ä¸€èˆ¬';
        } else if (value > -100) {
            fill.style.backgroundColor = '#ff0000'; // çº¢è‰²
            description = 'è¾ƒå·®';
        }

        var text = document.createElement('span');
        text.className = 'indicator-text';
        text.innerHTML = description + ' (' + value + ' dBm)';
        fill.appendChild(text);
        indicator.appendChild(fill);
        return indicator;
    }

    function createRSCPIndicator(value) {
        var indicator = document.createElement('div');
        indicator.className = 'indicator-bar';

        var fill = document.createElement('div');
        fill.className = 'indicator-fill';
        fill.style.width = ((-value - 44) / 96) * 100 + '%'; // è®¡ç®—æ¯”ä¾‹

        var description = '';
        if (value > -70) {
            fill.style.backgroundColor = '#00ff00'; // ç»¿è‰²
            description = 'å¼º';
        } else if (value > -100) {
            fill.style.backgroundColor = '#ffff00'; // é»„è‰²
            description = 'ä¸­';
        } else if (value > -140) {
            fill.style.backgroundColor = '#ff0000'; // çº¢è‰²
            description = 'å¼±';
        }

        var text = document.createElement('span');
        text.className = 'indicator-text';
        text.innerHTML = description + ' (' + value + ' dBm)';
        fill.appendChild(text);
        indicator.appendChild(fill);
        return indicator;
    }
    function updateElement(id, value) {
        var element = document.getElementById(id);
        if (value === undefined || value === null || value === "") {
            element.innerHTML = '<div class="loading">ğŸ”„ Getting C8 return value...</div>';
        } else {
            element.innerHTML = value;
        }
    }
    document.addEventListener("DOMContentLoaded", function() {
        // éšè—æ‰€æœ‰å†…å®¹
        document.querySelectorAll('.data-cell').forEach(function(el) {
            el.classList.add('hidden');
        });
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        document.querySelectorAll('.loading-cell').forEach(function(el) {
                el.innerHTML = '<div class="loading">ğŸ”„ åŠ è½½ä¸­...</div>';
        });   
        XHR.poll(30, '<%=luci.dispatcher.build_url("admin", "modem", "get_csq")%>', null,
            function(x, rv) {
                updateElement('stsss', rv.stsss);
                updateElement('modem', rv.modem);
                updateElement('conntype', rv.conntype);
                updateElement('firmware', rv.firmware);
                updateElement('date', rv.date);
                updateElement('simsel', rv.simsel);
                updateElement('cops', rv.cops);
                updateElement('imei', rv.imei);
                updateElement('imsi', rv.imsi);
                updateElement('iccid', rv.iccid);
                updateElement('mode', rv.mode);
                updateElement('rssi', rv.rssi);
                updateElement('rsrq', rv.rsrq);
                updateElement('rscp', rv.rscp);
                updateElement('sinr', rv.sinr);
                updateElement('mcc', rv.mcc);
                updateElement('lac', rv.lac);
                updateElement('cid', rv.cid);
                updateElement('band', rv.band);
                updateElement('rfcn', rv.rfcn);
                updateElement('pci', rv.pci);
                updateElement('apn', rv.apn);
                updateElement('down', rv.down);
                updateElement('up', rv.up);
                var phoneElement = document.getElementById('phone');
                var phone = rv.phone || "æœªæ£€æµ‹åˆ°å¡å·...";
                var isHidden = false;
                if (phone.length === 14) {
                    var newPhone = phone;
                    phoneElement.innerHTML = "**** **** **** ****";
                    phoneElement.addEventListener('dblclick', function() {
                        if (isHidden) {
                            phoneElement.innerHTML = "**** **** **** ****";
                            isHidden = false;
                        } else {
                            phoneElement.innerHTML = newPhone;
                            isHidden = true;
                        }
                    });
                } else {
                    phoneElement.innerHTML = phone;
                }
                var perElement = document.getElementById('per');
                var perValue = parseFloat(rv.per);
                if (isNaN(perValue)) {
                    perElement.innerHTML = '<div class="loading">ğŸ”„ Getting C8 return value...</div>';
                } else {
                    // åˆ›å»ºèƒ½é‡æ¡å’Œä¿¡å·æŒ‡ç¤ºå™¨å®¹å™¨
                    var energyBarContainer = document.createElement('div');
                    energyBarContainer.className = 'energy-bar-container';
                    // åˆ›å»ºèƒ½é‡æ¡
                    var energyBar = document.createElement('div');
                    energyBar.className = 'energy-bar';
                    var energyBarFill = document.createElement('div');
                    energyBarFill.className = 'energy-bar-fill';
                    energyBarFill.style.width = (perValue / 100) * 100 + '%';
                    if (perValue >= 70) {
                        energyBarFill.style.backgroundColor = '#00ff00';
                    } else if (perValue < 70 && perValue >= 40) {
                        energyBarFill.style.backgroundColor = '#ffff00';
                    } else {
                        energyBarFill.style.backgroundColor = '#ff0000';
                    }
                    var energyBarText = document.createElement('span');
                    energyBarText.className = 'energy-bar-text';
                    energyBarText.innerHTML = perValue + '%';
                    energyBarFill.appendChild(energyBarText);
                    energyBar.appendChild(energyBarFill);
                    // åˆ›å»ºä¿¡å·èœ‚çªæŒ‡ç¤ºå™¨
                    var signalIndicator = document.createElement('div');
                    signalIndicator.className = 'signal-indicator';
                    // åŠ¨æ€æ·»åŠ ä¿¡å·æŸ±
                    for (var i = 1; i <= 5; i++) {
                        var signalBar = document.createElement('div');
                        signalBar.className = 'signal-bar signal-bar-' + i;
                        if (i <= Math.ceil(perValue / 20)) {
                            // æ ¹æ®ä¿¡å·å¼ºåº¦è°ƒæ•´é¢œè‰²
                            if (perValue >= 70) {
                                signalBar.classList.add('signal-strong');
                            } else if (perValue < 70 && perValue >= 40) {
                                signalBar.classList.add('signal-medium');
                            } else {
                                signalBar.classList.add('signal-weak');
                            }
                        }
                        signalIndicator.appendChild(signalBar);
                    }
                    // å°†èƒ½é‡æ¡å’Œä¿¡å·æŒ‡ç¤ºå™¨åŠ å…¥å®¹å™¨
                    energyBarContainer.appendChild(energyBar);
                    energyBarContainer.appendChild(signalIndicator);
                    // å°†å®¹å™¨æ”¾å…¥é¡µé¢
                    perElement.innerHTML = '';
                    perElement.appendChild(energyBarContainer);
                }
                var temperElement = document.getElementById('temper');
                var temperValue = parseFloat(rv.temper);
                if (isNaN(temperValue)) {
                    temperElement.innerHTML = '<div class="loading">ğŸ”„ Getting C8 return value...</div>';
                } else {
                    var temperatureBar = document.createElement('div');
                    temperatureBar.className = 'temperature-bar';
                    var temperatureBarFill = document.createElement('div');
                    temperatureBarFill.className = 'temperature-bar-fill';
                    temperatureBarFill.style.width = (temperValue / 100) * 100 + '%'; 
                    if (temperValue >= 75) {
                        temperatureBarFill.style.backgroundColor = '#ff0000'; 
                    } else if (temperValue < 75 && temperValue >= 50) {
                        temperatureBarFill.style.backgroundColor = '#ffff00'; 
                    } else {
                        temperatureBarFill.style.backgroundColor = '#00ff00'; 
                    }
                    var temperatureBarText = document.createElement('span');
                    temperatureBarText.className = 'temperature-bar-text';
                    temperatureBarText.innerHTML = temperValue + 'Â°C';
                    temperatureBarFill.appendChild(temperatureBarText);
                    temperatureBar.appendChild(temperatureBarFill);
                    temperElement.innerHTML = '';
                    temperElement.appendChild(temperatureBar);
                }
                // å¤„ç†æ¨¡å—å‚å®¶
                var modemElement = document.getElementById('modem');
                modemElement.innerHTML = rv.modem; // ç¡®ä¿è®¾ç½®å†…å®¹ä¸ºæ©™è‰²ã€åŠ ç²—ç­‰
                var rssiValue = parseFloat(rv.rssi);
                var rssiElement = document.getElementById('rssi');
                rssiElement.innerHTML = '';  // æ¸…ç©ºå†…å®¹
                var rssiIndicator = createRSSIIndicator(rssiValue);
                rssiElement.appendChild(rssiIndicator);
                var rscpValue = parseFloat(rv.rscp);
                var rscpElement = document.getElementById('rscp');
                rscpElement.innerHTML = '';  // æ¸…ç©ºå†…å®¹
                var rscpIndicator = createRSCPIndicator(rscpValue);
                rscpElement.appendChild(rscpIndicator);
                document.querySelectorAll('.hidden').forEach(function(el) {
                    el.classList.remove('hidden'); // ç§»é™¤éšè—ç±»
                });
            }
       );
    });
//]]></script>
<div id="loadingOverlay" class="loading-overlay">
    <div>ğŸ”„ åŠ è½½ä¸­...è¯·åˆ·æ–°é¡µé¢ï¼</div>
</div>
<div class="cbi-map" id="cbi-modem">
    <h2 style="background-color: rgb(255, 98, 0); color: rgb(255, 255, 255);"><a id="content" name="content" style="text-decoration: none; color: inherit;"> QualcommÂ® Snapdragonâ„¢ X62-RM520N-Modem</a></h2>
    <fieldset class="cbi-section" id="cbi-mod">
        <legend><%:ç»¼åˆä¿¡æ¯%></legend>
        <table width="100%" cellspacing="10">
            <tr><td width="23%"><%:åå°æ‹‰å–çŠ¶æ€ %></td><td id="stsss">-</td><td></td></tr>
            <tr>
                <td width="23%"><%:æ¨¡å—å‚å®¶ %></td>
                <td id="modem"></td>
                <td id="modem"></td>
            </tr>
            <tr><td width="23%"><%:æ¨¡å—ç‰ˆæœ¬ %></td><td id="conntype"></td><td></td></tr>
            <tr><td width="23%"><%:å›ºä»¶ç‰ˆæœ¬ %></td><td id="firmware"></td><td></td></tr>
            <tr><td width="23%"><%:è®¾å¤‡æ¸©åº¦ %></td><td id="temper"></td><td></td></tr>
            <tr><td width="23%"><%:Script-Timeæ ‡è¯†: %></td><td id="date"></td><td></td></tr>
        </table>
    </fieldset>
    <fieldset class="cbi-section" id="cbi-msinfo">
        <legend><%:é€šä¿¡æ¨¡å—/SIMå¡ä¿¡æ¯%></legend>
        <table width="100%" cellspacing="10">
            <tr><td width="23%"><%:å¡æ§½ä½ç½® %></td><td id="simsel"></td><td></td></tr>
            <tr><td width="23%"><%:è¿è¥å•† %></td><td id="cops"></td><td></td></tr>
            <tr><td width="23%"><%:IMEIä¿¡æ¯ %></td><td id="imei"></td><td></td></tr>
            <tr><td width="23%"><%:IMSIä¿¡æ¯ %></td><td id="imsi"></td><td></td></tr>
            <tr><td width="23%"><%:ICC IDå· %></td><td id="iccid"></td><td></td></tr>
            <tr><td width="23%"><%:SIMå¡--Number %></td><td id="phone"></td><td></td></tr>
        </table>
    </fieldset>
    <fieldset class="cbi-section" id="cbi-sig">
        <legend><%:ä¿¡å·çŠ¶æ€%></legend>
        <table width="100%" cellspacing="10">
            <tr><td width="23%"><%:ç½‘ç»œç±»å‹--%></td><td id="mode"></td><td></td></tr>
            <tr><td width="23%"><%:ä¿¡å·è´¨é‡--%></td><td id="per"></td><td></td></tr>
            <tr>
                <td width="23%"><%:ä¿¡å·å¼ºåº¦--RSSI %></td>
                <td id="rssi"></td>
                <td id="rssiIndicator"></td>
            </tr>
            <tr>
                <td width="23%"><%:æ¥æ”¶åŠŸç‡--RSCP %></td>
                <td id="rscp"></td>
                <td id="rscpIndicator"></td>
            </tr>
            <tr><td width="23%"><%:æ¥æ”¶è´¨é‡--RSRQ %></td><td id="rsrq"></td><td></td></tr>
            <tr><td width="23%"><%:ä¿¡å™ªæ¯”å€¼--SINR %></td><td id="sinr"></td><td></td></tr>
        </table>
    </fieldset>
    <fieldset class="cbi-section" id="cbi-sig">
        <legend><%:åŸºç«™ä¿¡æ¯%></legend>
        <table width="100%" cellspacing="10">
            <tr><td width="23%"><%:MCC/MNC %></td><td id="mcc"></td><td></td></tr>
            <tr><td width="23%"><%:ä½ç½®ID LAC %></td><td id="lac"></td><td></td></tr>
            <tr><td width="23%"><%:å°åŒºID CellID %></td><td id="cid"></td><td></td></tr>
            <tr><td width="23%"><%:é¢‘æ®µBand %></td><td id="band"></td><td></td></tr>
            <tr><td width="23%"><%:é¢‘ç‚¹EARFCN %></td><td id="rfcn"></td><td></td></tr>
            <tr><td width="23%"><%:æ¥å…¥ç‚¹ APN %></td><td id="apn"></td><td></td></tr>
            <tr><td width="23%"><%:ç­¾çº¦ä¸‹è½½ç‡ %></td><td id="down"></td><td></td></tr>
            <tr><td width="23%"><%:ç­¾çº¦ä¸Šä¼ ç‡ %></td><td id="up"></td><td></td></tr>
            <tr><td width="23%"><%:ç‰©ç†å°åŒºæ ‡è¯†PCI %></td><td id="pci"></td><td></td></tr>
        </table>
    </fieldset>
</div>
<%+footer%>


#!/bin/sh
[ "$ACTION" = ifup ] || exit 0

WAN_IDX=$(uci show firewall | grep "=zone" | grep "'wan'" | cut -d'.' -f2 | head -n1)
CHANGED=0

if [ -n "$WAN_IDX" ]; then
    for iface in BLUE4WAN BLUE4WAN6; do
        if ! uci get firewall.$WAN_IDX.network 2>/dev/null | grep -q "$iface"; then
            uci add_list firewall.$WAN_IDX.network="$iface"
            echo "[bluewan-check] 已将 $iface 加入 wan 防火墙区"
            CHANGED=1
        fi
    done
fi

if [ "$CHANGED" -eq 1 ]; then
    uci commit firewall
    /etc/init.d/firewall reload
fi

# 调用 IPv6 自动配置脚本
[ -x /usr/bin/bluewan-ipv6-setup.sh ] && /usr/bin/bluewan-ipv6-setup.sh &

exit 0


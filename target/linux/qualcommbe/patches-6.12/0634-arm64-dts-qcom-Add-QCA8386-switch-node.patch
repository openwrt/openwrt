From 6fcb910cf3a9071e9e4af01ceafe38613ca555b6 Mon Sep 17 00:00:00 2001
From: Luo Jie <quic_luoj@quicinc.com>
Date: Wed, 5 Mar 2025 17:24:20 +0800
Subject: [PATCH 634/636] arm64: dts: qcom: Add QCA8386 switch node

QCA8386 is connected with the port 3 of IPQ5424.

Signed-off-by: Luo Jie <quic_luoj@quicinc.com>
---
 arch/arm64/boot/dts/qcom/ipq5424-rdp466.dts | 141 +++++++++++++++++++-
 1 file changed, 138 insertions(+), 3 deletions(-)

diff --git a/arch/arm64/boot/dts/qcom/ipq5424-rdp466.dts b/arch/arm64/boot/dts/qcom/ipq5424-rdp466.dts
index 1ec36acb9e25..a9f460ca66b4 100644
--- a/arch/arm64/boot/dts/qcom/ipq5424-rdp466.dts
+++ b/arch/arm64/boot/dts/qcom/ipq5424-rdp466.dts
@@ -120,6 +120,141 @@
 		};
 	};
 
+	pcsphy1: pcsphy@6 {
+		      compatible = "qcom,qca8k_pcs";
+		      reg = <6>;
+		      #clock-cells = <0x1>;
+
+		      clocks = <&qca8k_nsscc NSS_CC_SRDS1_SYS_CLK>,
+			       <&qca8k_nsscc NSS_CC_MAC0_RX_SRDS1_CLK>,
+			       <&qca8k_nsscc NSS_CC_MAC0_TX_SRDS1_CLK>;
+		      clock-names = "sys",
+				    "rx",
+				    "tx";
+		      resets = <&qca8k_nsscc NSS_CC_SRDS1_SYS_ARES>,
+			       <&qca8k_nsscc NSS_CC_MAC0_RX_SRDS1_ARES>,
+			       <&qca8k_nsscc NSS_CC_MAC0_TX_SRDS1_ARES>;
+		      reset-names = "sys",
+				    "rx",
+				    "tx";
+		      clock-output-names = "qca8k_uniphy_rx",
+					   "qca8k_uniphy_tx";
+	      };
+
+	switch@10 {
+		compatible = "qca,qca8386";
+		reg = <0x10>;
+		clocks = <&qca8k_uniphy1_tx312p5m>;
+		clock-names = "uniphy1_tx_312p5m_clk";
+
+		ports {
+			#address-cells = <1>;
+			#size-cells = <0>;
+
+			qca8k_cpu_port: port@0 {
+				reg = <0>;
+				phy-mode = "2500base-x";
+				pcsphy-handle = <&pcsphy1>;
+				ethernet = <&ppe_port3>;
+
+				clocks = <&qca8k_nsscc NSS_CC_MAC0_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC0_TX_CLK>;
+				clock-names = "port_rx_clk", "port_tx_clk";
+				fixed-link {
+					speed = <2500>;
+					full-duplex;
+					pause;
+				};
+
+			};
+
+			port@1 {
+				reg = <1>;
+				label = "lan1";
+				phy-mode = "sgmii";
+				phy-handle = <&dsa_phy0>;
+
+				clocks = <&qca8k_nsscc NSS_CC_MAC1_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC1_TX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC1_RX_CLK_SRC>,
+					 <&qca8k_nsscc NSS_CC_MAC1_TX_CLK_SRC>,
+					 <&qca8k_nsscc NSS_CC_MAC1_GEPHY0_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC1_GEPHY0_TX_CLK>;
+				clock-names = "port_rx_clk", "port_tx_clk",
+					      "port_rx_src_clk", "port_tx_src_clk",
+					      "ephy_rx_clk", "ephy_tx_clk";
+
+				resets = <&qca8k_nsscc NSS_CC_MAC1_GEPHY0_RX_ARES>,
+					 <&qca8k_nsscc NSS_CC_MAC1_GEPHY0_TX_ARES>;
+				reset-names = "ephy_rx_reset", "ephy_tx_reset";
+
+			};
+
+			port@2 {
+				reg = <2>;
+				label = "lan2";
+				phy-mode = "sgmii";
+				phy-handle = <&dsa_phy1>;
+
+				clocks = <&qca8k_nsscc NSS_CC_MAC2_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC2_TX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC2_RX_CLK_SRC>,
+					 <&qca8k_nsscc NSS_CC_MAC2_TX_CLK_SRC>,
+					 <&qca8k_nsscc NSS_CC_MAC2_GEPHY1_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC2_GEPHY1_TX_CLK>;
+				clock-names = "port_rx_clk", "port_tx_clk",
+					      "port_rx_src_clk", "port_tx_src_clk",
+					      "ephy_rx_clk", "ephy_tx_clk";
+
+				resets = <&qca8k_nsscc NSS_CC_MAC2_GEPHY1_RX_ARES>,
+					 <&qca8k_nsscc NSS_CC_MAC2_GEPHY1_TX_ARES>;
+				reset-names = "ephy_rx_reset", "ephy_tx_reset";
+			};
+
+			port@3 {
+				reg = <3>;
+				label = "lan3";
+				phy-mode = "sgmii";
+				phy-handle = <&dsa_phy2>;
+
+				clocks = <&qca8k_nsscc NSS_CC_MAC3_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC3_TX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC3_RX_CLK_SRC>,
+					 <&qca8k_nsscc NSS_CC_MAC3_TX_CLK_SRC>,
+					 <&qca8k_nsscc NSS_CC_MAC3_GEPHY2_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC3_GEPHY2_TX_CLK>;
+				clock-names = "port_rx_clk", "port_tx_clk",
+					      "port_rx_src_clk", "port_tx_src_clk",
+					      "ephy_rx_clk", "ephy_tx_clk";
+
+				resets = <&qca8k_nsscc NSS_CC_MAC3_GEPHY2_RX_ARES>,
+					 <&qca8k_nsscc NSS_CC_MAC3_GEPHY2_TX_ARES>;
+				reset-names = "ephy_rx_reset", "ephy_tx_reset";
+			};
+
+			port@4 {
+				reg = <4>;
+				label = "lan4";
+				phy-mode = "sgmii";
+				phy-handle = <&dsa_phy3>;
+
+				clocks = <&qca8k_nsscc NSS_CC_MAC4_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC4_TX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC4_RX_CLK_SRC>,
+					 <&qca8k_nsscc NSS_CC_MAC4_TX_CLK_SRC>,
+					 <&qca8k_nsscc NSS_CC_MAC4_GEPHY3_RX_CLK>,
+					 <&qca8k_nsscc NSS_CC_MAC4_GEPHY3_TX_CLK>;
+				clock-names = "port_rx_clk", "port_tx_clk",
+					      "port_rx_src_clk", "port_tx_src_clk",
+					      "ephy_rx_clk", "ephy_tx_clk";
+
+				resets = <&qca8k_nsscc NSS_CC_MAC4_GEPHY3_RX_ARES>,
+					 <&qca8k_nsscc NSS_CC_MAC4_GEPHY3_TX_ARES>;
+				reset-names = "ephy_rx_reset", "ephy_tx_reset";
+			};
+		};
+	};
+
 	qca8k_nsscc: qca8k-nsscc@18 {
 		compatible = "qcom,qca8084-nsscc";
 		reg = <0x18>;
@@ -129,8 +264,8 @@
 		clocks = <&cmn_pll IPQ5424_ETH2_50MHZ_CLK>,
 			 <0>,
 			 <0>,
-			 <0>,
-			 <0>,
+			 <&pcsphy1 0>,
+			 <&pcsphy1 1>,
 			 <&qca8k_uniphy1_rx312p5m>,
 			 <&qca8k_uniphy1_tx312p5m>;
 	};
@@ -269,7 +404,7 @@
 				      "tx";
 		};
 
-		port@3 {
+		ppe_port3: port@3 {
 			reg = <3>;
 			phy-mode = "2500base-x";
 			pcs-handle = <&pcs2_mii0>;
-- 
2.34.1


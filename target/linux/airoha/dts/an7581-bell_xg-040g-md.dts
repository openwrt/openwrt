// SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
/dts-v1/;

#include <dt-bindings/leds/common.h>
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include "an7581.dtsi"

/ {
	model = "Nokia Bell XG-040G-MD";
	compatible = "bell,xg-040g-md", "airoha,an7581";

	aliases {
		serial0 = &uart1;
	};

	chosen {
		bootargs = "ubi.mtd=ubi root=ubi0:rootfs rootfstype=squashfs ro rootwait console=ttyS0,115200 earlycon";
		stdout-path = "serial0:115200n8";
		linux,usable-memory-range = <0x0 0x80200000 0x0 0x1fe00000>;
	};

	memory@80000000 {
		device_type = "memory";
		reg = <0x0 0x80000000 0x0 0x80000000>;
	};

	efuse-banks {
		compatible = "airoha,an7581-efuses";
		#address-cells = <1>;
		#size-cells = <0>;

		bank@0 {
			reg = <0>;
		};

		bank@1 {
			reg = <1>;
		};
	};

	leds {
		compatible = "gpio-leds";

		pwr_led: led-0 {
			label = "green:power";
			color = <LED_COLOR_ID_GREEN>;
			function = LED_FUNCTION_POWER;
			gpios = <&en7581_pinctrl 17 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "default-on";
		};

		pon_led: led-1 {
			label = "green:pon";
			color = <LED_COLOR_ID_GREEN>;
			function = LED_FUNCTION_STATUS;
			gpios = <&en7581_pinctrl 18 GPIO_ACTIVE_LOW>;
		};

		los_led: led-2 {
			label = "red:los";
			color = <LED_COLOR_ID_RED>;
			function = LED_FUNCTION_STATUS;
			gpios = <&en7581_pinctrl 19 GPIO_ACTIVE_LOW>;
		};

		internet_led: led-3 {
			label = "green:internet";
			color = <LED_COLOR_ID_GREEN>;
			function = LED_FUNCTION_STATUS;
			gpios = <&en7581_pinctrl 20 GPIO_ACTIVE_LOW>;
		};
	};

	keys {
		compatible = "gpio-keys";

		reset {
			label = "reset";
			gpios = <&en7581_pinctrl 0 GPIO_ACTIVE_LOW>;
			linux,code = <KEY_RESTART>;
			debounce-interval = <60>;
		};
	};
};

&en7581_pinctrl {
	gpio-ranges = <&en7581_pinctrl 0 13 47>;

	mdio_pins: mdio-pins {
		mux {
			function = "mdio";
			groups = "mdio";
		};

		conf {
			pins = "gpio2";
			output-high;
		};
	};

	gswp2_led0_pins: gswp2-led0-pins {
		mux {
			pins = "gpio34";
			function = "phy2_led0";
		};
	};

	gswp3_led0_pins: gswp3-led0-pins {
		mux {
			pins = "gpio35";
			function = "phy3_led0";
		};
	};

	gswp4_led0_pins: gswp4-led0-pins {
		mux {
			pins = "gpio42";
			function = "phy4_led0";
		};
	};
};

&snfi {
	status = "okay";
};

&spi_nand {
	partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

		partition@0 {
			label = "bootloader";
			reg = <0x00000000 0x00080000>;
		};

		partition@80000 {
			label = "env";
			reg = <0x00080000 0x00080000>;
		};

		partition@100000 {
			label = "ubi";
			reg = <0x00100000 0x0ff00000>;
		};
	};
};

&i2c0 {
	status = "okay";
};

&eth {
	status = "okay";
};

&gdm1 {
	status = "okay";
};

&gdm4 {
	status = "okay";
	phy-handle = <&phy15>;
	phy-mode = "2500base-x";
	label = "eth1";
};

&switch {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&mdio_pins>;

	ports {
		port@2 {
			status = "okay";
			label = "lan2";
		};

		port@3 {
			status = "okay";
			label = "lan3";
		};

		port@4 {
			status = "okay";
			label = "lan4";
		};
	};

	mdio {
		ethernet-phy@a {
			status = "okay";
			pinctrl-names = "gbe-led";
			pinctrl-0 = <&gswp2_led0_pins>;

			leds {
				led@0 {
					status = "okay";
					active-low;
					function = LED_FUNCTION_LAN;
					color = <LED_COLOR_ID_GREEN>;
				};
			};
		};

		ethernet-phy@b {
			status = "okay";
			pinctrl-names = "gbe-led";
			pinctrl-0 = <&gswp3_led0_pins>;

			leds {
				led@0 {
					status = "okay";
					active-low;
					function = LED_FUNCTION_LAN;
					color = <LED_COLOR_ID_GREEN>;
				};
			};
		};

		ethernet-phy@c {
			status = "okay";
			pinctrl-names = "gbe-led";
			pinctrl-0 = <&gswp4_led0_pins>;

			leds {
				led@0 {
					status = "okay";
					active-low;
					function = LED_FUNCTION_LAN;
					color = <LED_COLOR_ID_GREEN>;
				};
			};
		};

		phy15: ethernet-phy@f {
			compatible = "ethernet-phy-id03a2.a411", "ethernet-phy-ieee802.3-c45";
			reg = <15>;

			reset-gpios = <&en7581_pinctrl 31 GPIO_ACTIVE_LOW>;
			reset-assert-us = <10000>;
			reset-deassert-us = <2000000>;

			leds {
				#address-cells = <1>;
				#size-cells = <0>;

				led@0 {
					reg = <0>;
					function = LED_FUNCTION_LAN;
					color = <LED_COLOR_ID_GREEN>;
				};
			};
		};
	};
};

&usb0 {
	status = "okay";
};

&usb1 {
	status = "okay";
	phys = <&usb1_phy PHY_TYPE_USB2>;
	mediatek,u3p-dis-msk = <0x1>;
};

From fdfaeca6b5eed05e446f298c5e597df39b96629a Mon Sep 17 00:00:00 2001
From: Linus Walleij <linusw@kernel.org>
Date: Thu, 12 Feb 2026 00:22:30 +0100
Subject: [PATCH 2/2] gemini: augment NAS4210 DTS with botched partitions

Same botched partitions as the Raidsonic IB-4220-B.

Signed-off-by: Linus Walleij <linusw@kernel.org>
---
 arch/arm/boot/dts/gemini/gemini-nas4210b.dts | 37 ++++++++++++++++++--
 1 file changed, 34 insertions(+), 3 deletions(-)

--- a/arch/arm/boot/dts/gemini/gemini-nas4210b.dts
+++ b/arch/arm/boot/dts/gemini/gemini-nas4210b.dts
@@ -84,10 +84,41 @@
 			/* 16MB of flash */
 			reg = <0x30000000 0x01000000>;
 
+			/*
+			 * Override the RedBoot partition table with fixed partitions
+			 * in order to create a coherent "firmware" partition so that
+			 * we can have optimal flash usage with OpenWrt in a big
+			 * MTD-splitted "firmware" partition.
+			 */
 			partitions {
-				compatible = "redboot-fis";
-				/* Eraseblock at 0xfe0000 */
-				fis-index-block = <0x7f>;
+				compatible = "fixed-partitions";
+				#address-cells = <1>;
+				#size-cells = <1>;
+				partition@0 {
+					label = "BOOT";
+					reg = <0x00000000 0x00020000>;
+					read-only;
+				};
+				partition@1 {
+					compatible = "openwrt,executable-prolog";
+					label = "firmware";
+					reg = <0x00020000 0x00f00000>;
+				};
+				partition@2 {
+					label = "VCTL";
+					reg = <0x00f20000 0x00020000>;
+					read-only;
+				};
+				partition@3 {
+					label = "CurConf";
+					reg = <0x00f40000 0x000a0000>;
+					read-only;
+				};
+				partition@4 {
+					label = "FIS directory";
+					reg = <0x00fe0000 0x00020000>;
+					read-only;
+				};
 			};
 		};
 

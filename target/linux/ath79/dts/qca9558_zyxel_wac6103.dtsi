// SPDX-License-Identifier: GPL-2.0-or-later OR MIT

#include "qca955x.dtsi"

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/leds/common.h>
#include <dt-bindings/mtd/partitions/uimage.h>

/ {
	aliases {
		label-mac-device = &eth1;
		led-boot = &led_power_green;
		led-failsafe = &led_power_red;
		led-upgrade = &led_power_green;
	};

	gpio-export {
		compatible = "gpio-export";

		gpio_radio0_ceiling {
			gpio-export,name = "radio0_ceiling";
			gpio-export,output = <0>;
			gpios = <&gpio 21 GPIO_ACTIVE_LOW>;
		};

		gpio_radio1_ceiling {
			gpio-export,name = "radio1_ceiling";
			gpio-export,output = <0>;
			gpios = <&gpio 20 GPIO_ACTIVE_LOW>;
		};
	};

	keys {
		compatible = "gpio-keys";

		reset {
			label = "reset";
			linux,code = <KEY_RESTART>;
			gpios = <&gpio 11 GPIO_ACTIVE_LOW>;
			debounce-interval = <60>;
		};

		antenna_switch {
			label = "antenna_switch";
			linux,code = <BTN_0>;
			linux,input-type = <EV_SW>;
			gpios = <&gpio 19 GPIO_ACTIVE_HIGH>;
			debounce-interval = <60>;
		};
	};

	led_spi {
		compatible = "spi-gpio";
		#address-cells = <1>;
		#size-cells = <0>;

		sck-gpios = <&gpio 18 GPIO_ACTIVE_HIGH>;
		mosi-gpios = <&gpio 15 GPIO_ACTIVE_HIGH>;
		cs-gpios = <&gpio 22 GPIO_ACTIVE_LOW>;
		num-chipselects = <1>;

		led_gpio: led_gpio@0 {
			compatible = "fairchild,74hc595";
			reg = <0>;
			gpio-controller;
			#gpio-cells = <2>;
			registers-number = <1>;
			spi-max-frequency = <100000>;
		};
	};

	leds {
		compatible = "gpio-leds";

		pinctrl-names = "default";
		pinctrl-0 = <&jtag_disable_pins>;

		led_power_green: power_green {
			function = LED_FUNCTION_POWER;
			color = <LED_COLOR_ID_GREEN>;
			gpios = <&gpio 12 GPIO_ACTIVE_HIGH>;
		};

		led_power_red: power_red {
			function = LED_FUNCTION_POWER;
			color = <LED_COLOR_ID_RED>;
			gpios = <&gpio 14 GPIO_ACTIVE_LOW>;
		};

		locator_white {
			function = "locator";
			color = <LED_COLOR_ID_WHITE>;
			gpios = <&gpio 13 GPIO_ACTIVE_HIGH>;
		};

		management_green {
			function = "management";
			color = <LED_COLOR_ID_GREEN>;
			gpios = <&led_gpio 0 GPIO_ACTIVE_LOW>;
		};

		management_red {
			function = "management";
			color = <LED_COLOR_ID_RED>;
			gpios = <&led_gpio 1 GPIO_ACTIVE_LOW>;
		};

		uplink_green {
			function = "uplink";
			color = <LED_COLOR_ID_GREEN>;
			gpios = <&led_gpio 2 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "netdev";
		};

		uplink_amber {
			function = "uplink";
			color = <LED_COLOR_ID_AMBER>;
			gpios = <&led_gpio 3 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "netdev";
		};

		lan1_green {
			function = "lan1";
			color = <LED_COLOR_ID_GREEN>;
			gpios = <&led_gpio 4 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "netdev";
		};

		lan1_amber {
			function = "lan1";
			color = <LED_COLOR_ID_AMBER>;
			gpios = <&led_gpio 5 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "netdev";
		};

		wlan2g {
			function = LED_FUNCTION_WLAN_2GHZ;
			color = <LED_COLOR_ID_GREEN>;
			gpios = <&led_gpio 6 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "phy1tpt";
		};

		wlan5g {
			function = LED_FUNCTION_WLAN_5GHZ;
			color = <LED_COLOR_ID_GREEN>;
			gpios = <&led_gpio 7 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "phy0tpt";
		};
	};
};

&spi {
	status = "okay";

	flash@0 {
		compatible = "jedec,spi-nor";
		reg = <0>;
		spi-max-frequency = <50000000>;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			partition@0 {
				label = "bootm";
				reg = <0x0 0x30000>;
				read-only;
			};

			partition@30000 {
				label = "recovery";
				reg = <0x30000 0x160000>;
				read-only;
			};

			partition@190000 {
				label = "ker_reserved";
				reg = <0x190000 0x120000>;
				read-only;
			};

			partition@2b0000 {
				label = "fs_reserved";
				reg = <0x2b0000 0x020000>;
				read-only;
			};

			partition@2d0000 {
				label = "conf";
				reg = <0x2d0000 0xce0000>;
				read-only;
			};

			partition@fb0000 {
				label = "mrd";
				reg = <0xfb0000 0x010000>;

				nvmem-layout {
					compatible = "fixed-layout";
					#address-cells = <1>;
					#size-cells = <1>;

					macaddr_mrd_0: macaddr@fff8 {
						compatible = "mac-base";
						reg = <0xfff8 0x6>;
						#nvmem-cell-cells = <1>;
					};
				};
			};

			partition@fc0000 {
				label = "disklog_reserved";
				reg = <0xfc0000 0x030000>;
				read-only;
			};

			partition@ff0000 {
				label = "art";
				reg = <0xff0000 0x010000>;
				read-only;

				nvmem-layout {
					compatible = "fixed-layout";
					#address-cells = <1>;
					#size-cells = <1>;

					cal_art_1000: calibration@1000 {
						reg = <0x1000 0x440>;
					};

					cal_art_5000: calibration@5000 {
						reg = <0x5000 0x844>;
					};
				};
			};
		};
	};
};

&nand {
	status = "okay";

	partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

		partition@0 {
			label = "bootm_reserved";
			reg = <0x0 0x100000>;
			read-only;
		};

		partition@100000 {
			label = "recovery_reserved";
			reg = <0x100000 0x100000>;
			read-only;
		};

		partition@200000 {
			label = "header";
			reg = <0x200000 0xa0000>;
		};

		partition@2a0000 {
			label = "kernel";
			reg = <0x2a0000 0x1860000>;
		};

		partition@1b00000 {
			label = "ubi";
			reg = <0x1b00000 0x5500000>;
		};

		partition@7000000 {
			label = "alt_header";
			reg = <0x7000000 0xa0000>;
		};

		partition@7a00000 {
			label = "alt_kernel";
			reg = <0x7a00000 0x1860000>;
			read-only;
		};

		partition@8900000 {
			label = "alt_ubi";
			reg = <0x8900000 0x5500000>;
			read-only;
		};

		partition@de00000 {
			label = "conf_reserved";
			reg = <0xde00000 0x100000>;
			read-only;
		};

		partition@df00000 {
			label = "mrd_reserved";
			reg = <0xdf00000 0x100000>;
			read-only;
		};

		partition@e000000 {
			label = "disklog";
			reg = <0xe000000 0x1f00000>;
			read-only;
		};

		partition@ff00000 {
			label = "ART_reserved";
			reg = <0xff00000 0x100000>;
			read-only;
		};
	};
};

&mdio0 {
	status = "okay";

	phy_port2: ethernet-phy@1 {
		reg = <1>;
	};

	phy_port3: ethernet-phy@2 {
		reg = <2>;
	};

	switch: switch@10 {
		compatible = "qca,qca8334";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0x10>;

		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@0 {
				reg = <0>;
				label = "cpu";
				ethernet = <&eth1>;
				phy-mode = "sgmii";
				qca,sgmii-enable-pll;
				qca,sgmii-rxclk-falling-edge;

				fixed-link {
					speed = <1000>;
					full-duplex;
				};
			};

			port@2 {
				reg = <2>;
				label = "uplink";
				phy-mode = "internal";
				phy-handle = <&phy_port2>;
			};

			port@3 {
				reg = <3>;
				label = "lan1";
				phy-mode = "internal";
				phy-handle = <&phy_port3>;
			};
		};
	};
};

&eth0 {
	status = "okay";

	nvmem-cells = <&macaddr_mrd_0 0>;
	nvmem-cell-names = "mac-address";

	gmac-config {
		device = <&gmac>;

		rgmii-enabled = <1>;

		rxdv-delay = <3>;
		rxd-delay = <3>;
		txen-delay = <0>;
		txd-delay = <0>;
	};
};

&eth1 {
	status = "okay";

	phy-mode = "sgmii";
	mdiobus = <&mdio0>;

	nvmem-cells = <&macaddr_mrd_0 0>;
	nvmem-cell-names = "mac-address";

	pll-data = <0x03000000 0x00000101 0x00001313>;

	gmac-config {
		device = <&gmac>;
	};

	fixed-link {
		speed = <1000>;
		full-duplex;
	};
};

&pcie1 {
	status = "okay";

	ath10k: wifi@0,0 {
		compatible = "qcom,ath10k";
		reg = <0x0000 0 0 0 0>;

		nvmem-cells = <&cal_art_5000>, <&macaddr_mrd_0 2>;
		nvmem-cell-names = "calibration", "mac-address";

		#gpio-cells = <2>;
		gpio-controller;
	};
};

&wdt {
	status = "okay";
};

&wmac {
	status = "okay";

	nvmem-cells = <&macaddr_mrd_0 1>, <&cal_art_1000>;
	nvmem-cell-names = "mac-address", "calibration";
};
